# 自動テストを書く

1972年のエッセイ「謙虚なプログラマ」でエドガー・W・ダイクストラは以下のように述べています。「プログラムのテストは、バグの存在を示すには非常に効率的な手法であるが、バグの不在を示すには望み薄く不適切である」と。これは、できるだけテストを試みるべきではないということではありません。

プログラムの正しさは、コードが意図していることをどの程度行っているかです。Rustはプログラムの正当性に重きを置いて設計されていますが、正当性は複雑で、単純に証明することはありません。Rustの型システムはこの負担の大きな部分を負っていますが、型システムはあらゆる種類の誤りをキャッチできません。そのため、Rustには言語内での自動ソフトウェアテストの作成がサポートされています。

例として、`add_two`という関数を書いて、渡される数値に2を加えたとします。この関数のシグニチャは、パラメータとして整数を受け取り、結果として整数を返します。この関数を実装してコンパイルするとき、Rustはこれまでに学んだすべての型チェックと借用チェックを行い、たとえば、`String`の値や無効な参照をこの関数に渡していないかなどを確かめます。ところが、コンパイラはプログラマがまさしく意図したことを関数が実行しているかどうかは確かめられません。つまり、引数に10を足したり、50を引いたりするのではなく、引数に2を足していることです。このような時にテストは必要になります。

たとえば、`add_two`関数に`3`を渡すと返される値は`5`であるというテストを書くことができます。ードを変更するたびにこれらのテストを実行することで、既存の正しい動作が変更されていないことを確認できます。

テストは複雑なスキルです。よいテストの書き方をあらゆる方面から解説することは1章だけではできませんが、Rustのテスト機能のメカニズムについて議論します。テストの作成時に使用できるアノテーションやマクロ、テストの実行に必要なデフォルトの動作とオプション、単体テストと統合テストへのテストの構成方法について説明します。
