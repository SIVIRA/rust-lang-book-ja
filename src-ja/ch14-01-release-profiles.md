## リリースプロファイルでビルドをカスタマイズする

Rustにおいて*リリースプロファイル*とは、プログラマーがコードをコンパイルするためのさまざまなオプションをより詳細に制御できるように、構成が異なる事前定義されたカスタマイズ可能なプロファイルです。各プロファイルは他のプロファイルとは独立して構成されています。

Cargoには2つの主要なプロファイルがあります。`cargo build`を実行する際にCargoが使用する`dev`プロファイルと`cargo build --release`を実行する際に使用する`release`プロファイルです。`dev`プロファイルは開発のための適切なデフォルトで定義され、`release`プロファイルはリリースビルドに適切なデフォルトを持っています。

これらのプロファイル名は、ビルドの出力で馴染みのあるものかもしれません。

```text
$ cargo build
    Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs
$ cargo build --release
    Finished release [optimized] target(s) in 0.0 secs
```

このビルド出力に表示される`dev`と`release`は、コンパイラが異なるプロファイルを使用していることを示しています。

Cargoには、プロジェクトの*Cargo.toml*ファイルに`[profile.*]`セクションがない場合に適用される各プロファイルのデフォルト設定があります。カスタマイズしたいプロファイルに対して`[profile.*]`セクションを追加することで、デフォルト設定のサブセットを上書きすることができます。例えば、`dev`と`release`プロファイルの`opt-level`設定のデフォルト値は次のとおりです。

<span class="filename">ファイル名: Cargo.toml</span>

```toml
[profile.dev]
opt-level = 0

[profile.release]
opt-level = 3
```

`opt-level`設定は、Rustがコードに適用する最適化の回数を0〜3の範囲で制御します。さらに最適化を適用するとコンパイル時間が延びるので、コードを頻繁に開発してコンパイルする場合は、結果として得られるコードが遅く実行されても、コンパイルがより速くなります。これが`dev`のデフォルト`opt-level`が`0`である理由です。コードをリリースする準備ができたら、コンパイルにもっと時間を費やすのが最善です。一度だけリリースモードでコンパイルしますが、コンパイルされたプログラムは何度も実行されるため、リリースモードでは実行速度が遅いコードのコンパイル時間が長くなります。そのため、 `release`プロファイルのデフォルトの`opt-level`は `3`です。

*Cargo.toml*に別の値を追加することで、デフォルト設定を上書きすることができます。たとえば、開発プロファイルで最適化レベル1を使用する場合は、プロジェクトの*Cargo.toml*ファイルに次の2行を追加できます。

<span class="filename">ファイル名: Cargo.toml</span>

```toml
[profile.dev]
opt-level = 1
```

このコードはデフォルト設定の`0`を無効にします。今度は`cargo build`を実行すると、Cargoは`dev`プロファイルのデフォルトと`opt-level`へのカスタマイズを使用します。`opt-level`を`1`に設定しているので、Cargoはデフォルトよりも多くの最適化を適用しますが、リリースビルドよりも多くは適用しません。

各プロファイルの設定オプションとデフォルトの一覧については、[Cargoのドキュメント](https://doc.rust-lang.org/cargo/)を参照してください。